<form class="expense-form" [formGroup]="expenseForm" (ngSubmit)="onSubmit()">
  <!-- Expense Type Selection -->
  <div class="form-group">
    <label for="type">Expense Type *</label>
    <select id="type" formControlName="type" class="form-control">
      <option [ngValue]="null">Select expense type</option>
      @for (type of expenseTypes; track type) {
        <option [ngValue]="type">
          {{ getExpenseTypeName(type) }}
        </option>
      }
    </select>
    @if (showError('type','required')) {
      <div class="error-message">Expense type is required</div>
    }
  </div>

  <!-- Dynamic Form Fields -->
  @if (selectedType) {
    <div class="dynamic-fields">
      @switch (selectedType) {
        @case (ExpenseType.CarRental) {
          <div class="form-group">
            <label for="carName">Car Name *</label>
            <input type="text" id="carName" formControlName="carName" class="form-control">
            @if (showError('carName','required')) {
              <div class="error-message">Car name is required</div>
            }
          </div>

          <div class="form-group">
            <label for="pickUpDateTime">Pick-up Date & Time *</label>
            <input type="datetime-local" id="pickUpDateTime" formControlName="pickUpDateTime" class="form-control">
            @if (showError('pickUpDateTime','required')) {
              <div class="error-message">Pick-up date & time is required</div>
            }
          </div>

          <div class="form-group">
            <label for="dropOffDateTime">Drop-off Date & Time *</label>
            <input type="datetime-local" id="dropOffDateTime" formControlName="dropOffDateTime" class="form-control">
            @if (showError('dropOffDateTime','required')) {
              <div class="error-message">Drop-off date & time is required</div>
            }
            @if (showError('dropOffDateTime','invalidDateRange')) {
              <div class="error-message">Drop-off date must be after pick-up date</div>
            }
          </div>

          <div class="form-group">
            <label for="pickUpLocation">Pick-up Location *</label>
            <input type="text" id="pickUpLocation" formControlName="pickUpLocation" class="form-control">
            @if (showError('pickUpLocation','required')) {
              <div class="error-message">Pick-up location is required</div>
            }
          </div>

          <div class="form-group">
            <label for="dropOffLocation">Drop-off Location *</label>
            <input type="text" id="dropOffLocation" formControlName="dropOffLocation" class="form-control">
            @if (showError('dropOffLocation','required')) {
              <div class="error-message">Drop-off location is required</div>
            }
          </div>
        }

        @case (ExpenseType.Hotel) {
          <div class="form-group">
            <label for="hotelName">Hotel Name *</label>
            <input type="text" id="hotelName" formControlName="hotelName" class="form-control">
            @if (showError('hotelName','required')) {
              <div class="error-message">Hotel name is required</div>
            }
          </div>

          <div class="form-group">
            <label for="hotelLocation">Hotel Location *</label>
            <input type="text" id="hotelLocation" formControlName="hotelLocation" class="form-control">
            @if (showError('hotelLocation','required')) {
              <div class="error-message">Hotel location is required</div>
            }
          </div>

          <div class="form-group">
            <label for="checkInDate">Check-in Date *</label>
            <input type="date" id="checkInDate" formControlName="checkInDate" class="form-control">
            @if (showError('checkInDate','required')) {
              <div class="error-message">Check-in date is required</div>
            }
          </div>

          <div class="form-group">
            <label for="checkoutDate">Check-out Date *</label>
            <input type="date" id="checkoutDate" formControlName="checkoutDate" class="form-control">
            @if (showError('checkoutDate','required')) {
              <div class="error-message">Check-out date is required</div>
            }
            @if (showError('checkoutDate','invalidDateRange')) {
              <div class="error-message">Check-out date must be after check-in date</div>
            }
          </div>
        }

        @case (ExpenseType.Flight) {
          <div class="form-group">
            <label for="airline">Airline *</label>
            <input type="text" id="airline" formControlName="airline" class="form-control">
            @if (showError('airline','required')) {
              <div class="error-message">Airline is required</div>
            }
          </div>

          <div class="form-group">
            <label for="from">From *</label>
            <input type="text" id="from" formControlName="from" class="form-control">
            @if (showError('from','required')) {
              <div class="error-message">Departure location is required</div>
            }
          </div>

          <div class="form-group">
            <label for="to">To *</label>
            <input type="text" id="to" formControlName="to" class="form-control">
            @if (showError('to','required')) {
              <div class="error-message">Arrival location is required</div>
            }
          </div>

          <div class="form-group">
            <label for="departureDateTime">Departure Date & Time *</label>
            <input type="datetime-local" id="departureDateTime" formControlName="departureDateTime" class="form-control">
            @if (showError('departureDateTime','required')) {
              <div class="error-message">Departure date & time is required</div>
            }
          </div>

          <div class="form-group">
            <label for="arrivalDateTime">Arrival Date & Time *</label>
            <input type="datetime-local" id="arrivalDateTime" formControlName="arrivalDateTime" class="form-control">
            @if (showError('arrivalDateTime','required')) {
              <div class="error-message">Arrival date & time is required</div>
            }
            @if (showError('arrivalDateTime','invalidDateRange')) {
              <div class="error-message">Arrival date & time must be after departure</div>
            }
          </div>
        }

        @case (ExpenseType.Taxi) {
          <div class="form-group">
            <label for="from">From *</label>
            <input type="text" id="from" formControlName="from" class="form-control">
            @if (showError('from','required')) {
              <div class="error-message">Pick-up location is required</div>
            }
          </div>

          <div class="form-group">
            <label for="to">To *</label>
            <input type="text" id="to" formControlName="to" class="form-control">
            @if (showError('to','required')) {
              <div class="error-message">Drop-off location is required</div>
            }
          </div>

          <div class="form-group">
            <label for="dateTime">Date & Time (pick-up time) *</label>
            <input type="datetime-local" id="dateTime" formControlName="dateTime" class="form-control">
            @if (showError('dateTime','required')) {
              <div class="error-message">Pick-up date & time is required</div>
            }
          </div>
        }
      }
      <!-- Total Price Field -->
      <div class="form-group">
        <label for="totalPrice">{{ getFieldLabel('totalPrice') }} *</label>
        <input type="number" id="totalPrice" formControlName="totalPrice" class="form-control" step="0.01" min="0.01">
        @if (showError('totalPrice','required')) {
          <div class="error-message">Total price is required</div>
        }
        @if (showError('totalPrice','min')) {
          <div class="error-message">Total price must be greater than $0</div>
        }
      </div>
    </div>
  }

  <!-- Form Actions -->
  <div class="form-actions">
    <button type="submit" class="btn btn-primary" [disabled]="!expenseForm.valid || isLoading">
      {{ isEditMode ? 'Save Changes' : 'Create Expense' }}
    </button>
    <button type="button" class="btn btn-secondary" (click)="onCancel()">Cancel</button>
  </div>
</form>
